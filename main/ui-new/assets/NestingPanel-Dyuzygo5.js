import{p as Y,l as j,k as d,u as le,a as K,t as f,i as e,b as w,S as L,m as ge,e as ne,f as ve,g as oe,c as Q,h as ye,o as be,F as xe,s as B,d as re}from"./index-YKK_3g9I.js";class pe{progressCleanup=null;statusCleanup=null;completeCleanup=null;errorCleanup=null;constructor(){this.initializeEventListeners()}initializeEventListeners(){this.progressCleanup=Y.onNestProgress(t=>{j.setNestingProgress(t)}),this.statusCleanup=Y.onNestStatus(t=>{j.setNestingStatus(t.isRunning),j.setWorkerStatus({isRunning:t.isRunning,currentOperation:t.operation})}),this.completeCleanup=Y.onNestComplete(t=>{if(j.setNests(t),t.length>0){const a=t.reduce((b,y)=>y.fitness<b.fitness?y:b);j.setCurrentNest(a)}}),this.errorCleanup=Y.onNestError(t=>{j.setError(t)})}async startNesting(){try{j.setError(null);const t=d.config;if(!this.validateConfig(t))throw new Error("Invalid configuration");if(d.app.parts.length===0)throw new Error("No parts loaded. Please import parts before starting nesting.");if(d.app.sheets.length===0)throw new Error("No sheets configured. Please configure sheets before starting nesting.");await Y.startNesting(t)}catch(t){const a=t instanceof Error?t.message:"Unknown error occurred";throw j.setError(a),j.setNestingStatus(!1),t}}async stopNesting(){try{await Y.stopNesting(),j.setNestingStatus(!1),j.setNestingProgress(0),j.setError(null)}catch(t){const a=t instanceof Error?t.message:"Failed to stop nesting";throw j.setError(a),t}}stopBackgroundWorker(){Y.stopBackgroundWorker(),j.setNestingStatus(!1),j.setNestingProgress(0),j.setWorkerStatus({isRunning:!1,currentOperation:"Stopped"})}validateConfig(t){return!(!t||t.spacing<0||t.rotations<1||t.populationSize<1||t.mutationRate<0||t.mutationRate>100||t.threads<1||!t.units||!t.placementType)}get isNesting(){return d.process.isNesting}get progress(){return d.process.progress}get workerStatus(){return d.process.workerStatus}get results(){return d.app.nests}get lastError(){return d.process.lastError}onBackgroundProgress(t){return Y.onBackgroundProgress(t)}onBackgroundResponse(t){return Y.onBackgroundResponse(t)}cleanup(){this.progressCleanup?.(),this.statusCleanup?.(),this.completeCleanup?.(),this.errorCleanup?.(),this.progressCleanup=null,this.statusCleanup=null,this.completeCleanup=null,this.errorCleanup=null}}const he=new pe;var _e=f('<div class="text-sm text-gray-600 dark:text-gray-400 text-center">: '),$e=f('<div class="bg-gray-50 dark:bg-gray-700 p-3 rounded"><span class="text-sm font-medium text-gray-700 dark:text-gray-300">:</span><span class="ml-2 text-sm text-gray-900 dark:text-gray-100">'),ke=f('<div class="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200 dark:border-gray-600"><div class="flex justify-between"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span class="text-sm font-medium text-gray-900 dark:text-gray-100"></span></div><div class="flex justify-between"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span class="text-sm font-medium text-gray-900 dark:text-gray-100">'),we=f('<div class="p-6 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 m-4"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100"></h3><div class="text-2xl font-bold text-blue-600 dark:text-blue-400">%</div></div><div class=mb-6><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-2 overflow-hidden"><div class="h-full bg-blue-500 dark:bg-blue-400 rounded-full transition-all duration-300 ease-out"></div></div></div><div class=space-y-4><div class="grid grid-cols-2 gap-4"><div class="flex justify-between"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span class="text-sm font-medium text-gray-900 dark:text-gray-100"></span></div><div class="flex justify-between"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span></span></div></div></div><div class="flex justify-center pt-4 border-t border-gray-200 dark:border-gray-600"><button class="text-blue-600 dark:text-blue-400 hover:underline text-sm">');const Ce=()=>{const[r]=le("nesting"),t=K(()=>Math.max(0,Math.min(100,d.process.progress))),a=K(()=>{const b=t();if(b===0)return null;const S=6e4*(100-b)/b;return S<6e4?`${Math.round(S/1e3)}s`:`${Math.round(S/6e4)}m`});return(()=>{var b=we(),y=b.firstChild,S=y.firstChild,F=S.nextSibling,P=F.firstChild,C=y.nextSibling,N=C.firstChild,R=N.firstChild,u=C.nextSibling,l=u.firstChild,n=l.firstChild,o=n.firstChild,c=o.firstChild,_=o.nextSibling,A=n.nextSibling,D=A.firstChild,O=D.firstChild,V=D.nextSibling,$=u.nextSibling,z=$.firstChild;return e(S,()=>r("nesting_in_progress")),e(F,()=>t().toFixed(1),P),e(C,w(L,{get when(){return a()},get children(){var x=_e(),k=x.firstChild;return e(x,()=>r("estimated_time_remaining"),k),e(x,a,null),x}}),null),e(u,w(L,{get when(){return d.process.workerStatus.currentOperation},get children(){var x=$e(),k=x.firstChild,M=k.firstChild,G=k.nextSibling;return e(k,()=>r("current_operation"),M),e(G,()=>d.process.workerStatus.currentOperation),x}}),l),e(o,()=>r("threads_active"),c),e(_,()=>d.process.workerStatus.threadsActive),e(D,()=>r("worker_status"),O),e(V,(()=>{var x=ge(()=>!!d.process.workerStatus.isRunning);return()=>x()?r("running"):r("stopped")})()),e(u,w(L,{get when(){return d.process.currentNest},get children(){var x=ke(),k=x.firstChild,M=k.firstChild,G=M.firstChild,q=M.nextSibling,g=k.nextSibling,s=g.firstChild,i=s.firstChild,m=s.nextSibling;return e(M,()=>r("current_generation"),G),e(q,()=>d.process.currentNest?.generation||0),e(s,()=>r("best_fitness"),i),e(m,()=>d.process.currentNest?.fitness?.toFixed(2)||"N/A"),x}}),null),z.$$click=()=>window.location.reload(),e(z,()=>r("refresh_status")),ne(x=>{var k=`${t()}%`,M=`text-sm font-medium ${d.process.workerStatus.isRunning?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`;return k!==x.e&&((x.e=k)!=null?R.style.setProperty("width",k):R.style.removeProperty("width")),M!==x.t&&ve(V,x.t=M),x},{e:void 0,t:void 0}),b})()};oe(["click"]);class Se{isConnectedSignal=Q(!1);lastHeartbeatSignal=Q(Date.now());reconnectAttemptsSignal=Q(0);connectionErrorSignal=Q(null);get isConnected(){return this.isConnectedSignal[0]}get setIsConnected(){return this.isConnectedSignal[1]}get lastHeartbeat(){return this.lastHeartbeatSignal[0]}get setLastHeartbeat(){return this.lastHeartbeatSignal[1]}get reconnectAttempts(){return this.reconnectAttemptsSignal[0]}get setReconnectAttempts(){return this.reconnectAttemptsSignal[1]}get connectionError(){return this.connectionErrorSignal[0]}get setConnectionError(){return this.connectionErrorSignal[1]}heartbeatInterval=null;reconnectTimeout=null;maxReconnectAttempts=5;heartbeatInterval_ms=5e3;reconnectDelay_ms=2e3;constructor(){this.initializeConnection()}initializeConnection(){this.checkConnection(),this.startHeartbeat(),this.setupEventListeners()}async checkConnection(){try{if(Y.isAvailable)await Y.readConfig(),this.setConnectionStatus(!0),this.setReconnectAttempts(0),this.setConnectionError(null);else throw new Error("IPC not available")}catch(t){const a=t instanceof Error?t.message:"Connection failed";this.setConnectionStatus(!1),this.setConnectionError(a),this.reconnectAttempts()<this.maxReconnectAttempts&&this.scheduleReconnect()}}setConnectionStatus(t){this.setIsConnected(t),this.setLastHeartbeat(Date.now()),j.setWorkerStatus({isRunning:t&&d.process.isNesting,currentOperation:t?"Connected":"Disconnected"})}startHeartbeat(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(()=>{this.checkConnection()},this.heartbeatInterval_ms)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}scheduleReconnect(){this.reconnectTimeout&&clearTimeout(this.reconnectTimeout);const t=this.reconnectAttempts();this.setReconnectAttempts(t+1);const a=Math.min(this.reconnectDelay_ms*Math.pow(2,t),3e4);this.reconnectTimeout=setTimeout(()=>{this.checkConnection()},a)}setupEventListeners(){Y.onNestError(t=>{(t.includes("IPC")||t.includes("connection")||t.includes("timeout"))&&(this.setConnectionError(t),this.setConnectionStatus(!1))}),ye(()=>{const t=this.isConnected(),a=this.connectionError();!t&&a?j.setError(`Connection lost: ${a}`):t&&d.process.lastError?.includes("Connection lost")&&j.setError(null)})}async forceReconnect(){this.setReconnectAttempts(0),this.setConnectionError(null),await this.checkConnection()}get connected(){return this.isConnected()}get error(){return this.connectionError()}get reconnectionAttempts(){return this.reconnectAttempts()}get lastHeartbeatTime(){return this.lastHeartbeat()}get isHealthy(){const t=Date.now(),a=this.lastHeartbeat(),b=t-a;return this.isConnected()&&b<this.heartbeatInterval_ms*2}get status(){return{connected:this.connected,healthy:this.isHealthy,error:this.error,reconnectAttempts:this.reconnectionAttempts,lastHeartbeat:this.lastHeartbeatTime}}cleanup(){this.stopHeartbeat(),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}}const ce=new Se;var Ne=f('<div class="text-sm text-gray-600 dark:text-gray-400">'),Ee=f('<div class="p-4 border-b border-gray-200 dark:border-gray-700"><h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"></h4><div class="grid grid-cols-2 gap-4"><div><span class="text-xs text-gray-500 dark:text-gray-400"></span><div class="font-mono text-sm text-gray-900 dark:text-gray-100"></div></div><div><span class="text-xs text-gray-500 dark:text-gray-400"></span><div class="font-mono text-sm text-gray-900 dark:text-gray-100">%'),Me=f('<div class="space-y-2 max-h-64 overflow-y-auto">'),Pe=f('<div class=p-4><h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"> (<!>)'),Re=f('<span class="text-xs text-red-600 dark:text-red-400">(<!>)'),Ae=f('<div class="p-4 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-700"><div class="flex items-center space-x-2"><div class="w-2 h-2 rounded-full bg-red-500"></div><span class="text-sm text-red-700 dark:text-red-300">'),De=f('<div class="p-4 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-700"><div class="flex items-start space-x-2"><div class="w-2 h-2 rounded-full bg-red-500 mt-1"></div><div><div class="text-sm font-medium text-red-700 dark:text-red-300"></div><div class="text-xs text-red-600 dark:text-red-400 mt-1">'),ze=f('<div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 m-4"><div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700"><div class="flex items-center space-x-3"><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100"></h3><div></div></div><div class="flex items-center space-x-2"><span class="text-sm text-gray-500 dark:text-gray-400">: </span><button class="text-blue-600 dark:text-blue-400 hover:underline text-sm"></button></div></div><div class="p-4 border-b border-gray-200 dark:border-gray-700"><div class="flex items-center justify-between mb-2"><span class="text-sm font-medium text-gray-700 dark:text-gray-300"></span><span class="text-sm font-bold text-blue-600 dark:text-blue-400">%</span></div><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-2"><div class="h-full bg-blue-500 dark:bg-blue-400 rounded-full transition-all duration-300">'),Te=f('<div class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">'),je=f('<div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded"><div class="flex items-center space-x-3"><div class="w-2 h-2 rounded-full bg-blue-500"></div><span class="text-sm font-medium text-gray-700 dark:text-gray-300">#</span></div><div class="flex items-center space-x-4"><div class=text-right><div class="text-xs text-gray-500 dark:text-gray-400"></div><div class="font-mono text-sm text-gray-900 dark:text-gray-100"></div></div><div class=text-right><div class="text-xs text-gray-500 dark:text-gray-400"></div><div class="font-mono text-sm text-gray-900 dark:text-gray-100">%</div></div><div class=text-right><div class="text-xs text-gray-500 dark:text-gray-400"></div><div class="font-mono text-sm text-gray-900 dark:text-gray-100">');const Fe=()=>{const[r]=le("nesting"),[t,a]=Q([]),[b,y]=Q(Date.now()),[S,F]=Q(!1),P=he.onBackgroundProgress(n=>{y(Date.now()),console.log("Background progress:",n)}),C=he.onBackgroundResponse(n=>{a(o=>[n,...o].slice(0,10)),y(Date.now())});be(()=>{P?.(),C?.()});const N=()=>{const n=Date.now(),o=b(),c=n-o;return c<1e3?r("just_now"):c<6e4?r("seconds_ago",{count:Math.floor(c/1e3)}):c<36e5?r("minutes_ago",{count:Math.floor(c/6e4)}):r("hours_ago",{count:Math.floor(c/36e5)})},R=()=>{const n=ce.status;return n.connected?n.healthy?"text-green-500":"text-yellow-500":"text-red-500"},u=n=>n.toFixed(4),l=n=>(n*100).toFixed(1);return(()=>{var n=ze(),o=n.firstChild,c=o.firstChild,_=c.firstChild,A=_.nextSibling,D=c.nextSibling,O=D.firstChild,V=O.firstChild,$=O.nextSibling,z=o.nextSibling,x=z.firstChild,k=x.firstChild,M=k.nextSibling,G=M.firstChild,q=x.nextSibling,g=q.firstChild;return e(_,()=>r("live_results")),e(O,()=>r("last_update"),V),e(O,N,null),$.$$click=()=>F(!S()),e($,(()=>{var s=ge(()=>!!S());return()=>s()?r("collapse"):r("expand")})()),e(k,()=>r("current_progress")),e(M,()=>(d.process.progress*100).toFixed(1),G),e(z,w(L,{get when(){return d.process.workerStatus.currentOperation},get children(){var s=Ne();return e(s,()=>d.process.workerStatus.currentOperation),s}}),null),e(n,w(L,{get when(){return d.process.currentNest},get children(){var s=Ee(),i=s.firstChild,m=i.nextSibling,v=m.firstChild,E=v.firstChild,I=E.nextSibling,U=v.nextSibling,J=U.firstChild,X=J.nextSibling,ee=X.firstChild;return e(i,()=>r("best_result")),e(E,()=>r("fitness")),e(I,()=>u(d.process.currentNest.fitness)),e(J,()=>r("utilization")),e(X,()=>l(d.process.currentNest.utilisation),ee),s}}),null),e(n,w(L,{get when(){return S()},get children(){var s=Pe(),i=s.firstChild,m=i.firstChild,v=m.nextSibling;return v.nextSibling,e(i,()=>r("intermediate_results"),m),e(i,()=>t().length,v),e(s,w(L,{get when(){return t().length>0},get fallback(){return(()=>{var E=Te();return e(E,()=>r("no_intermediate_results")),E})()},get children(){var E=Me();return e(E,w(xe,{get each(){return t()},children:(I,U)=>(()=>{var J=je(),X=J.firstChild,ee=X.firstChild,te=ee.nextSibling;te.firstChild;var h=X.nextSibling,T=h.firstChild,H=T.firstChild,p=H.nextSibling,W=T.nextSibling,se=W.firstChild,Z=se.nextSibling,ie=Z.firstChild,ae=W.nextSibling,de=ae.firstChild,ue=de.nextSibling;return e(te,()=>I.index,null),e(H,()=>r("fitness")),e(p,()=>u(I.fitness)),e(se,()=>r("utilization")),e(Z,()=>l(I.utilisation),ie),e(de,()=>r("sheets")),e(ue,()=>I.placements.length),J})()})),E}}),null),s}}),null),e(n,w(L,{get when(){return!ce.status.connected},get children(){var s=Ae(),i=s.firstChild,m=i.firstChild,v=m.nextSibling;return e(v,()=>r("connection_lost")),e(i,w(L,{get when(){return ce.status.reconnectAttempts>0},get children(){var E=Re(),I=E.firstChild,U=I.nextSibling;return U.nextSibling,e(E,()=>r("reconnect_attempts",{count:ce.status.reconnectAttempts}),U),E}}),null),s}}),null),e(n,w(L,{get when(){return d.process.lastError},get children(){var s=De(),i=s.firstChild,m=i.firstChild,v=m.nextSibling,E=v.firstChild,I=E.nextSibling;return e(E,()=>r("error_occurred")),e(I,()=>d.process.lastError),s}}),null),ne(s=>{var i=`w-2 h-2 rounded-full ${R()}`,m=ce.status.connected?r("connected"):r("disconnected"),v=`${d.process.progress*100}%`;return i!==s.e&&ve(A,s.e=i),m!==s.t&&B(A,"title",s.t=m),v!==s.a&&((s.a=v)!=null?g.style.setProperty("width",v):g.style.removeProperty("width")),s},{e:void 0,t:void 0,a:void 0}),n})()};oe(["click"]);const Ie={initialZoom:1,initialPan:{x:0,y:0},bounds:{minZoom:.1,maxZoom:10},zoomStep:1.2,enableKeyboardShortcuts:!0,enableWheelZoom:!0,enablePan:!0},He=(r={})=>{const t={...Ie,...r},[a,b]=Q(t.initialZoom),[y,S]=Q(t.initialPan),[F,P]=Q(!1),[C,N]=Q({x:0,y:0}),[R,u]=Q({x:0,y:0}),l=K(()=>{const s=a(),i=y();return`translate(${i.x}, ${i.y}) scale(${s})`}),n=K(()=>({zoom:a(),pan:y(),isDragging:F()})),o=s=>Math.max(t.bounds.minZoom,Math.min(t.bounds.maxZoom,s)),c=s=>{if(!t.bounds.panBounds)return s;const i=t.bounds.panBounds;return{x:Math.max(i.minX,Math.min(i.maxX,s.x)),y:Math.max(i.minY,Math.min(i.maxY,s.y))}},_=(s=t.zoomStep)=>{b(i=>o(i*s))},A=(s=t.zoomStep)=>{b(i=>o(i/s))},D=s=>{b(o(s))},O=s=>{const v=800/s.width,E=600/s.height,I=Math.min(v,E)*.9;if(b(o(I)),s.x!==void 0&&s.y!==void 0){const U=400-(s.x+s.width/2)*I,J=600/2-(s.y+s.height/2)*I;S(c({x:U,y:J}))}},V=s=>{S(c(s))},$=s=>{const i=y();V({x:i.x+s.x,y:i.y+s.y})},z=()=>{S({x:0,y:0})},x=()=>{b(t.initialZoom),S(t.initialPan),P(!1)},k=s=>{if(!t.enablePan)return;s.preventDefault(),P(!0);const i=y();N({x:s.clientX,y:s.clientY}),u(i)},M=s=>{if(!F()||!t.enablePan)return;s.preventDefault();const i=C(),m=R(),v={x:m.x+(s.clientX-i.x),y:m.y+(s.clientY-i.y)};S(c(v))},G=s=>{F()&&(s.preventDefault(),P(!1))},q=s=>{if(!t.enableWheelZoom)return;s.preventDefault();const m=s.deltaY>0?1/t.zoomStep:t.zoomStep,v=s.target.getBoundingClientRect(),E=s.clientX-v.left,I=s.clientY-v.top,U=a(),J=y(),X=o(U*m);if(X!==U){const ee=X/U,te={x:E-(E-J.x)*ee,y:I-(I-J.y)*ee};b(X),S(c(te))}},g=s=>{if(t.enableKeyboardShortcuts&&!(s.ctrlKey||s.metaKey||s.altKey))switch(s.key){case"+":case"=":s.preventDefault(),_();break;case"-":s.preventDefault(),A();break;case"0":s.preventDefault(),x();break;case"ArrowUp":s.preventDefault(),$({x:0,y:50});break;case"ArrowDown":s.preventDefault(),$({x:0,y:-50});break;case"ArrowLeft":s.preventDefault(),$({x:50,y:0});break;case"ArrowRight":s.preventDefault(),$({x:-50,y:0});break}};return t.enableKeyboardShortcuts&&(document.addEventListener("keydown",g),be(()=>{document.removeEventListener("keydown",g)})),{zoom:a,pan:y,isDragging:F,transform:l,viewportState:n,zoomIn:_,zoomOut:A,zoomTo:D,zoomToFit:O,panTo:V,panBy:$,centerView:z,resetView:x,handleMouseDown:k,handleMouseMove:M,handleMouseUp:G,handleWheel:q,cursor:K(()=>F()?"grabbing":"grab")}};var Ze=f('<div class="flex items-center justify-center gap-2 p-2 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"><div class="flex items-center gap-1 px-2 py-1 bg-gray-50 dark:bg-gray-700 rounded-md"><button class="p-1 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"></path></svg></button><span class="text-sm font-mono text-gray-700 dark:text-gray-300 min-w-12 text-center">%</span><button class="p-1 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"></path></svg></button></div><button class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg></button><button class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button><div class="flex items-center gap-2 px-2 py-1 bg-gray-50 dark:bg-gray-700 rounded-md ml-2"><span class="text-xs text-gray-500 dark:text-gray-400">Pan:</span><span class="text-xs font-mono text-gray-700 dark:text-gray-300"></span></div><div class="flex items-center gap-1 px-2 py-1 bg-gray-50 dark:bg-gray-700 rounded-md ml-2"><span class="text-xs text-gray-500 dark:text-gray-400">: +/- <!>, ↑↓←→ <!>, 0 '),Be=f('<button class="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 rounded transition-colors"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4">');const Le=r=>{const[t]=le("common"),a=K(()=>Math.round(r.viewportState.zoom*100)),b=K(()=>{const y=r.viewportState.pan;return`${Math.round(y.x)}, ${Math.round(y.y)}`});return(()=>{var y=Ze(),S=y.firstChild,F=S.firstChild,P=F.nextSibling,C=P.firstChild,N=P.nextSibling,R=S.nextSibling,u=R.nextSibling,l=u.nextSibling,n=l.firstChild,o=n.nextSibling,c=l.nextSibling,_=c.firstChild,A=_.firstChild,D=A.nextSibling,O=D.nextSibling,V=O.nextSibling;return V.nextSibling,re(F,"click",r.onZoomOut,!0),e(P,a,C),re(N,"click",r.onZoomIn,!0),e(y,(()=>{var $=ge(()=>!!r.showFitToContent);return()=>$()&&(()=>{var z=Be();return re(z,"click",r.onZoomToFit,!0),ne(()=>B(z,"title",t("fit_to_content"))),z})()})(),R),re(R,"click",r.onCenterView,!0),re(u,"click",r.onResetView,!0),e(o,b),e(_,()=>t("shortcuts"),A),e(_,()=>t("zoom"),D),e(_,()=>t("pan"),V),e(_,()=>t("reset"),null),ne($=>{var z=t("zoom_out"),x=t("zoom_in"),k=t("center_view"),M=t("reset_view");return z!==$.e&&B(F,"title",$.e=z),x!==$.t&&B(N,"title",$.t=x),k!==$.a&&B(R,"title",$.a=k),M!==$.o&&B(u,"title",$.o=M),$},{e:void 0,t:void 0,a:void 0,o:void 0}),y})()};oe(["click"]);var Oe=f('<div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100">ms'),Ve=f('<div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100">'),Ue=f('<div class="h-full flex flex-col"><div class="flex-1 flex"><div class="flex-1 bg-white dark:bg-gray-900"><svg class="w-full h-96 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800"width=100% height=400 viewBox="0 0 800 400"><g><defs><pattern id=grid width=20 height=20 patternUnits=userSpaceOnUse><path d="M 20 0 L 0 0 0 20"fill=none stroke=#e0e0e0 stroke-width=1></path></pattern></defs><rect width=800 height=400 fill=url(#grid)></rect></g></svg></div><div class="w-80 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 overflow-y-auto"><div class=p-4><h4 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4"></h4><div class="grid grid-cols-2 gap-3 mb-6"><div class="bg-gray-50 dark:bg-gray-700 p-3 rounded text-center"><div class="text-2xl font-bold text-green-600 dark:text-green-400"></div><div class="text-xs text-gray-600 dark:text-gray-400 mt-1"></div></div><div class="bg-gray-50 dark:bg-gray-700 p-3 rounded text-center"><div class="text-2xl font-bold text-gray-900 dark:text-gray-100"></div><div class="text-xs text-gray-600 dark:text-gray-400 mt-1"></div></div><div class="bg-gray-50 dark:bg-gray-700 p-3 rounded text-center"><div class="text-2xl font-bold text-gray-900 dark:text-gray-100"></div><div class="text-xs text-gray-600 dark:text-gray-400 mt-1"></div></div><div class="bg-gray-50 dark:bg-gray-700 p-3 rounded text-center"><div class="text-2xl font-bold text-red-600 dark:text-red-400">%</div><div class="text-xs text-gray-600 dark:text-gray-400 mt-1"></div></div></div><div class=space-y-3><div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100"></span></div><div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100">'),We=f('<svg><g class=sheet-group><rect fill="rgba(200, 200, 200, 0.3)"stroke=#e5e7eb stroke-width=2></rect><text font-size=12 fill=#6b7280> </svg>',!1,!0,!1),Xe=f('<svg><g class=part-group><rect fill="rgba(59, 130, 246, 0.7)"stroke=#3b82f6 stroke-width=1></svg>',!1,!0,!1);const Ye=r=>{const[t]=le("nesting"),a=He({initialZoom:1,bounds:{minZoom:.1,maxZoom:10},enableKeyboardShortcuts:!0,enableWheelZoom:!0,enablePan:!0}),b=K(()=>r.result.sheets?.reduce((C,N)=>C+N.width*N.height,0)||0),y=K(()=>r.result.placedParts||0),S=K(()=>{const C=b(),N=y();return C===0?0:(C-N)/C*100}),F=K(()=>{const C=r.result.sheets||[];if(C.length===0)return{width:800,height:400,x:0,y:0};let N=1/0,R=1/0,u=-1/0,l=-1/0;return C.forEach(n=>{const o=n.x||0,c=n.y||0;N=Math.min(N,o),R=Math.min(R,c),u=Math.max(u,o+n.width),l=Math.max(l,c+n.height)}),{x:N,y:R,width:u-N,height:l-R}}),P=()=>{a.zoomToFit(F())};return(()=>{var C=Ue(),N=C.firstChild,R=N.firstChild,u=R.firstChild,l=u.firstChild,n=l.firstChild;n.nextSibling;var o=R.nextSibling,c=o.firstChild,_=c.firstChild,A=_.nextSibling,D=A.firstChild,O=D.firstChild,V=O.nextSibling,$=D.nextSibling,z=$.firstChild,x=z.nextSibling,k=$.nextSibling,M=k.firstChild,G=M.nextSibling,q=k.nextSibling,g=q.firstChild,s=g.firstChild,i=g.nextSibling,m=A.nextSibling,v=m.firstChild,E=v.firstChild,I=E.firstChild,U=E.nextSibling,J=v.nextSibling,X=J.firstChild,ee=X.firstChild,te=X.nextSibling;return e(C,w(Le,{get viewportState(){return a.viewportState()},get onZoomIn(){return a.zoomIn},get onZoomOut(){return a.zoomOut},onZoomToFit:P,get onResetView(){return a.resetView},get onCenterView(){return a.centerView},showFitToContent:!0,showPanControls:!0}),N),re(u,"wheel",a.handleWheel),re(u,"mouseleave",a.handleMouseUp),re(u,"mouseup",a.handleMouseUp,!0),re(u,"mousemove",a.handleMouseMove,!0),re(u,"mousedown",a.handleMouseDown,!0),e(l,w(xe,{get each(){return r.result.sheets||[]},children:(h,T)=>(()=>{var H=We(),p=H.firstChild,W=p.nextSibling,se=W.firstChild;return e(W,()=>t("sheet"),se),e(W,()=>T()+1,null),ne(Z=>{var ie=h.x||0,ae=h.y||0,de=h.width,ue=h.height,fe=(h.x||0)+10,me=(h.y||0)+25;return ie!==Z.e&&B(p,"x",Z.e=ie),ae!==Z.t&&B(p,"y",Z.t=ae),de!==Z.a&&B(p,"width",Z.a=de),ue!==Z.o&&B(p,"height",Z.o=ue),fe!==Z.i&&B(W,"x",Z.i=fe),me!==Z.n&&B(W,"y",Z.n=me),Z},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),H})()}),null),e(l,w(xe,{get each(){return r.result.placements||[]},children:h=>(()=>{var T=Xe(),H=T.firstChild;return ne(p=>{var W=h.x,se=h.y,Z=h.width||50,ie=h.height||50,ae=`rotate(${h.rotation||0} ${h.x+(h.width||50)/2} ${h.y+(h.height||50)/2})`;return W!==p.e&&B(H,"x",p.e=W),se!==p.t&&B(H,"y",p.t=se),Z!==p.a&&B(H,"width",p.a=Z),ie!==p.o&&B(H,"height",p.o=ie),ae!==p.i&&B(H,"transform",p.i=ae),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),T})()}),null),e(_,()=>t("statistics")),e(O,(()=>{var h=ge(()=>!!r.result.efficiency);return()=>h()?`${(r.result.efficiency*100).toFixed(1)}%`:"N/A"})()),e(V,()=>t("material_efficiency")),e(z,()=>r.result.fitness?.toFixed(2)||"N/A"),e(x,()=>t("fitness_score")),e(M,()=>r.result.sheets?.length||0),e(G,()=>t("sheets_used")),e(g,()=>S().toFixed(1),s),e(i,()=>t("material_waste")),e(E,()=>t("total_parts_placed"),I),e(U,()=>r.result.placedParts||0),e(X,()=>t("total_material_used"),ee),e(te,()=>b().toFixed(2)),e(m,w(L,{get when(){return r.result.generationTime},get children(){var h=Oe(),T=h.firstChild,H=T.firstChild,p=T.nextSibling,W=p.firstChild;return e(T,()=>t("generation_time"),H),e(p,()=>r.result.generationTime,W),h}}),null),e(m,w(L,{get when(){return r.result.generation},get children(){var h=Ve(),T=h.firstChild,H=T.firstChild,p=T.nextSibling;return e(T,()=>t("generation_number"),H),e(p,()=>r.result.generation),h}}),null),ne(h=>{var T=a.cursor(),H=a.transform();return T!==h.e&&((h.e=T)!=null?u.style.setProperty("cursor",T):u.style.removeProperty("cursor")),H!==h.t&&B(l,"transform",h.t=H),h},{e:void 0,t:void 0}),C})()};oe(["mousedown","mousemove","mouseup"]);var Ke=f('<div class="h-full flex flex-col"><div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"><button class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">← </button><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100"></h3><div class="flex gap-2"><button class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">📤 '),Ge=f('<div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100"> (<!>)</h3><div class="text-sm text-gray-600 dark:text-gray-400"><label>'),qe=f('<div class="flex-1 overflow-y-auto p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">'),Je=f('<div class="h-full flex flex-col">'),Qe=f('<span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full">'),et=f('<div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100">'),tt=f('<div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-lg transition-shadow duration-200"><div class="h-32 bg-gray-50 dark:bg-gray-700 flex items-center justify-center cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"><div class=text-center><div class="text-2xl mb-1">🎯</div><div class="text-sm text-gray-600 dark:text-gray-400"></div></div></div><div class=p-4><div class="flex items-center justify-between mb-3"><h4 class="font-medium text-gray-900 dark:text-gray-100"> #</h4></div><div class="space-y-2 mb-4"><div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-green-600 dark:text-green-400"></span></div><div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100"></span></div><div class="flex justify-between text-sm"><span class="text-gray-600 dark:text-gray-400">:</span><span class="font-medium text-gray-900 dark:text-gray-100"></span></div></div><div class="flex justify-between items-center pt-2 border-t border-gray-200 dark:border-gray-700"><button class="text-blue-600 dark:text-blue-400 hover:underline text-sm"></button><div class="flex gap-2"><button class="text-blue-600 dark:text-blue-400 hover:underline text-sm"></button><button class="text-red-600 dark:text-red-400 hover:underline text-sm">');const rt=()=>{const[r]=le("nesting"),[t,a]=Q(null),[b,y]=Q("grid"),S=K(()=>[...d.app.nests].sort((l,n)=>l.efficiency!==n.efficiency?(n.efficiency||0)-(l.efficiency||0):(n.fitness||0)-(l.fitness||0))),F=l=>{a(l),y("detail")},P=()=>{a(null),y("grid")},C=async l=>{if(Y.isAvailable)try{const n=await Y.saveFileDialog({title:r("export_result"),defaultPath:`nest_result_${l.id}.svg`,filters:[{name:"SVG Files",extensions:["svg"]},{name:"DXF Files",extensions:["dxf"]},{name:"All Files",extensions:["*"]}]});if(n.canceled||!n.filePath)return;await Y.exportNestResult(l,n.filePath)}catch(n){console.error("Failed to export result:",n),j.setError(r("export_failed"))}},N=l=>{const n=d.app.nests.filter(o=>o.id!==l.id);j.setNests(n)},R=l=>l?`${(l*100).toFixed(1)}%`:"N/A",u=l=>l?l.toFixed(2):"N/A";return(()=>{var l=Je();return e(l,w(L,{get when(){return ge(()=>b()==="detail")()&&t()},get children(){var n=Ke(),o=n.firstChild,c=o.firstChild;c.firstChild;var _=c.nextSibling,A=_.nextSibling,D=A.firstChild;return D.firstChild,c.$$click=P,e(c,()=>r("back_to_results"),null),e(_,()=>r("result_details")),D.$$click=()=>C(t()),e(D,()=>r("export"),null),e(n,w(Ye,{get result(){return t()}}),null),n}}),null),e(l,w(L,{get when(){return b()==="grid"},get children(){return[(()=>{var n=Ge(),o=n.firstChild,c=o.firstChild,_=c.nextSibling;_.nextSibling;var A=o.nextSibling,D=A.firstChild;return e(o,()=>r("nesting_results"),c),e(o,()=>S().length,_),e(D,()=>r("sorted_by_efficiency")),n})(),(()=>{var n=qe();return e(n,w(xe,{get each(){return S()},children:(o,c)=>(()=>{var _=tt(),A=_.firstChild,D=A.firstChild,O=D.firstChild,V=O.nextSibling,$=A.nextSibling,z=$.firstChild,x=z.firstChild,k=x.firstChild,M=z.nextSibling,G=M.firstChild,q=G.firstChild,g=q.firstChild,s=q.nextSibling,i=G.nextSibling,m=i.firstChild,v=m.firstChild,E=m.nextSibling,I=i.nextSibling,U=I.firstChild,J=U.firstChild,X=U.nextSibling,ee=M.nextSibling,te=ee.firstChild,h=te.nextSibling,T=h.firstChild,H=T.nextSibling;return A.$$click=()=>F(o),e(V,()=>r("click_to_view")),e(x,()=>r("result"),k),e(x,()=>c()+1,null),e(z,w(L,{get when(){return c()===0},get children(){var p=Qe();return e(p,()=>r("best")),p}}),null),e(q,()=>r("efficiency"),g),e(s,()=>R(o.efficiency)),e(m,()=>r("fitness"),v),e(E,()=>u(o.fitness)),e(U,()=>r("sheets_used"),J),e(X,()=>o.sheets?.length||0),e(M,w(L,{get when(){return o.placedParts},get children(){var p=et(),W=p.firstChild,se=W.firstChild,Z=W.nextSibling;return e(W,()=>r("parts_placed"),se),e(Z,()=>o.placedParts),p}}),null),te.$$click=()=>F(o),e(te,()=>r("view_details")),T.$$click=()=>C(o),e(T,()=>r("export")),H.$$click=()=>N(o),e(H,()=>r("delete")),_})()})),n})()]}}),null),l})()};oe(["click"]);var st=f('<button class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200">🗑️ '),nt=f('<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 p-4">'),it=f('<div class="h-full flex flex-col"><div class="flex items-center justify-between p-5 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"><h2 class="text-lg font-medium text-gray-900 dark:text-gray-100"></h2><div class="flex gap-2"><button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">▶️ </button><button class="inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">⏹️ </button></div></div><div class="flex items-center justify-between p-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"><div class="flex gap-6"><div class="flex items-center gap-2"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span class="text-sm font-medium text-gray-900 dark:text-gray-100"></span></div><div class="flex items-center gap-2"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span class="text-sm font-medium text-gray-900 dark:text-gray-100"></span></div><div class="flex items-center gap-2"><span class="text-sm text-gray-600 dark:text-gray-400">:</span><span class="text-sm font-medium text-gray-900 dark:text-gray-100"></span></div></div></div><div class="flex-1 overflow-hidden">'),at=f('<p class="text-amber-600 dark:text-amber-400">'),lt=f('<div class="h-full flex flex-col items-center justify-center text-center gap-4 p-8"><div class="text-6xl opacity-30">🎯</div><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100"></h3><p class="text-gray-600 dark:text-gray-400">');const dt=()=>{const[r]=le("nesting"),t=K(()=>d.app.parts.length>0&&d.app.sheets.length>0&&!d.process.isNesting),a=K(()=>d.app.nests.length>0),b=async()=>{if(t())try{await he.startNesting()}catch(P){console.error("Failed to start nesting:",P)}},y=async()=>{if(d.process.isNesting)try{await he.stopNesting()}catch(P){console.error("Failed to stop nesting:",P)}},S=()=>{j.setNests([])},F=K(()=>d.app.parts.filter(P=>P.quantity>0).length);return(()=>{var P=it(),C=P.firstChild,N=C.firstChild,R=N.nextSibling,u=R.firstChild;u.firstChild;var l=u.nextSibling;l.firstChild;var n=C.nextSibling,o=n.firstChild,c=o.firstChild,_=c.firstChild,A=_.firstChild,D=_.nextSibling,O=c.nextSibling,V=O.firstChild,$=V.firstChild,z=V.nextSibling,x=O.nextSibling,k=x.firstChild,M=k.firstChild,G=k.nextSibling,q=n.nextSibling;return e(N,()=>r("nesting_title")),u.$$click=b,e(u,()=>r("start_nesting"),null),l.$$click=y,e(l,()=>r("stop_nesting"),null),e(R,w(L,{get when(){return a()&&!d.process.isNesting},get children(){var g=st();return g.firstChild,g.$$click=S,e(g,()=>r("clear_results"),null),ne(()=>B(g,"title",r("clear_results"))),g}}),null),e(_,()=>r("parts_to_nest"),A),e(D,F),e(V,()=>r("available_sheets"),$),e(z,()=>d.app.sheets.length),e(k,()=>r("results_count"),M),e(G,()=>d.app.nests.length),e(q,w(L,{get when(){return d.process.isNesting},get children(){var g=nt();return e(g,w(Ce,{}),null),e(g,w(Fe,{}),null),g}}),null),e(q,w(L,{get when(){return a()},get fallback(){return(()=>{var g=lt(),s=g.firstChild,i=s.nextSibling,m=i.nextSibling;return e(i,()=>r("no_nesting_results")),e(m,()=>r("start_nesting_to_see_results")),e(g,w(L,{get when(){return!t()},get children(){var v=at();return e(v,()=>r("add_parts_and_sheets_first")),v}}),null),g})()},get children(){return w(rt,{})}}),null),ne(g=>{var s=!t(),i=t()?r("start_nesting"):r("cannot_start_nesting"),m=!d.process.isNesting,v=r("stop_nesting");return s!==g.e&&(u.disabled=g.e=s),i!==g.t&&B(u,"title",g.t=i),m!==g.a&&(l.disabled=g.a=m),v!==g.o&&B(l,"title",g.o=v),g},{e:void 0,t:void 0,a:void 0,o:void 0}),P})()};oe(["click"]);export{dt as default};
